import{w as oe,x as ie,y as se,r as f,z as le,A as de,c as me,R as g,b as v,G as i,j as e,D as m,d as h,B}from"./index.6f94c60a.js";import{g as he,i as ce,b as pe,B as xe,A as fe,u as ge,c as Ee}from"./houses.bdd5c657.js";import{D,I as P,C as G,A as ye,a as Se,L as be}from"./LoadingButton.63d18e7c.js";import"./dividerClasses.ded1b393.js";function Le(){const n=oe(ie),E=se("/casas/:slug"),c=f.exports.useMemo(()=>(E==null?void 0:E.params.slug)=="actualizar",[E==null?void 0:E.params.slug]),_=c&&n?{houseRif:n.rif,houseName:n.name,houseAddress:n.address,housePhones:n.phones.map(r=>({value:r})),houseMaxShares:n.maxShares,houseMaximumAge:n.maximumAge,houseMinimumAge:n.minimumAge,houseCurrentShares:n.currentShares,houseScheduleStartTime:n.scheduleStartTime,houseScheduleEndTime:n.scheduleEndTime,houseContactCI:n.contact.ci.toString(),houseContactName:n.contact.name,houseContactLastname:n.contact.lastname}:{housePhones:[{value:""}]},J=le({mode:"all",defaultValues:_}),{control:d,formState:{errors:a,isValid:K},watch:y,setError:S,register:Q,clearErrors:L,resetField:V,handleSubmit:X,setValue:w}=J,{fields:Y,append:Z,remove:ee}=de({control:d,name:"housePhones"}),I=y("houseMinimumAge"),M=y("houseMaximumAge"),N=y("houseScheduleStartTime"),F=y("houseScheduleEndTime"),[re,b]=f.exports.useState(!1),[R,W]=f.exports.useState(!1),O=Q("houseImage",{required:!c}),[T,te]=f.exports.useState(c&&n?he(n):null),z=f.exports.useRef({el:null}),ae=r=>{O.ref(r),z.current.el=r,r==null||r.addEventListener("change",t=>{var o;const u=(o=r==null?void 0:r.files)==null?void 0:o[0];if(u){const s=URL.createObjectURL(u);te(s)}})},q=me(),ue=r=>{b(!0),c&&n?ge(r,n).then(([t,u])=>{b(!1),t?q("/casas"):window.alert(`Un error ha ocurrido en la actualizaci\xF3n del campo ${u}. Por favor intente m\xE1s tarde`)}).catch(()=>{b(!1),window.alert("Un error ha ocurrido en la actualizaci\xF3n de la casa. Por favor intente m\xE1s tarde")}):c||Ee(r).then(async t=>{b(!1),t&&(t.ok?q("/casas"):window.alert("Un error ha ocurrido al procesar el formulario, por favor intente mas tarde."))}).catch(()=>{b(!1),window.alert("Un error ha ocurrido al procesar el formulario, por favor intente mas tarde.")})},C=y("houseRif"),U=y("houseContactCI"),[p,ne]=f.exports.useState(null),[H,k]=f.exports.useState(null);return g.useEffect(()=>{var r;Number(I)>Number(M)&&((r=a.houseMaximumAge)==null?void 0:r.type)!="coherent"?S("houseMaximumAge",{type:"coherent"}):Number(I)<Number(M)&&L("houseMaximumAge")},[I,M]),g.useEffect(()=>{var j,$;if(!N&&!F)return;const[r,t]=N.split(":"),[u,o]=F.split(":"),s=Number(r),l=Number(t),x=Number(u),A=Number(o);s>x||s==x&&l>l?S("houseScheduleEndTime",{type:"coherent"}):x<s||s==x&&A<l?S("houseScheduleStartTime",{type:"coherent"}):x==s&&l==A?(S("houseScheduleEndTime",{type:"coherent"}),S("houseScheduleStartTime",{type:"coherent"})):(((j=a.houseScheduleStarTime)==null?void 0:j.type)=="coherent"&&L("houseScheduleStartTime"),(($=a.houseScheduleEndTime)==null?void 0:$.type)=="coherent"&&L("houseScheduleEndTime"))},[N,F]),g.useEffect(()=>{n&&n.rif==C||C&&C.length==9&&(W(!0),ce(C).then(r=>{r||S("houseRif",{type:"unicity"}),W(!1)}))},[C]),g.useEffect(()=>{pe().then(ne)},[]),g.useEffect(()=>{const r=p==null?void 0:p[Number(U)];r?(w("houseContactName",r.name),w("houseContactLastname",r.lastname),k(r)):(V("houseContactName"),V("houseContactLastname"),k(null))},[U,p]),g.useEffect(()=>{!n&&c&&q("/casas")},[n,c]),v("form",{onSubmit:X(ue),children:[v(i,{container:!0,spacing:3,children:[e(i,{item:!0,xs:12,children:e(D,{sx:{color:"rgba(0,0,0,0.4)"},children:"INFOMRACI\xD3N DE LA CASA"})}),e(i,{item:!0,xs:1}),v(i,{item:!0,xs:10,children:[v(xe,{onClick:()=>{var r,t;return(t=(r=z.current)==null?void 0:r.el)==null?void 0:t.click()},sx:{width:"100%",paddingTop:"56.25%",position:"relative",backgroundColor:T?"":"#545454",cursor:"pointer"},children:[T&&e("img",{alt:"Imagen de casa hogar",src:T,style:{width:"100%",height:"100%",cursor:"pointer",position:"absolute",inset:0}}),!T&&e("div",{style:{margin:"auto",position:"absolute",inset:0,display:"flex"},children:e("h2",{style:{margin:"auto",color:"white"},children:"Subir imagen de la casa hogar"})})]}),e("label",{style:{display:"none"},htmlFor:"house-image",children:e("input",{accept:"image/*",type:"file",style:{display:"none"},...O,ref:ae})})]}),e(i,{item:!0,xs:1}),e(i,{item:!0,xs:6,children:e(m,{control:d,name:"houseName",rules:{required:!0,maxLength:50},defaultValue:"",render:({field:r})=>{var t,u;return e(h,{fullWidth:!0,error:!!a.houseName,variant:"outlined",label:"Nombre de la Casa",helperText:((t=a.houseName)==null?void 0:t.type)=="required"?"El nombre no puede estar vacio":((u=a.houseName)==null?void 0:u.type)=="maxLength"?"El nombre no puede tener mas de 50 caracteres":"",...r})}})}),e(i,{item:!0,xs:6,children:e(m,{control:d,name:"houseRif",rules:{required:!0,maxLength:9,minLength:9,pattern:/[123456789]+/},defaultValue:"",render:({field:r})=>{var t,u,o,s,l;return e(h,{fullWidth:!0,disabled:R,InputProps:{startAdornment:e(P,{position:"start",children:"J-"}),endAdornment:e(P,{position:"end",children:R&&e(G,{size:"1.5em"})})},variant:"outlined",label:"RIF de la Casa",error:!!a.houseRif,helperText:((t=a.houseRif)==null?void 0:t.type)=="required"?"El RIF no puede estart vacio":((u=a.houseRif)==null?void 0:u.type)=="pattern"?"El RIF solo puede tener digitos":((o=a.houseRif)==null?void 0:o.type)=="maxLength"||((s=a.houseRif)==null?void 0:s.type)=="minLength"?"El RIF solo puede tener 9 numeros":((l=a.houseRif)==null?void 0:l.type)=="unicity"?"El RIF no es unico":"",...r})}})}),e(i,{item:!0,xs:12,children:e(m,{control:d,defaultValue:"",name:"houseAddress",rules:{required:!0,maxLength:255},render:({field:r})=>{var t,u;return e(h,{fullWidth:!0,multiline:!0,label:"Direcci\xF3n de la Casa",rows:8,placeholder:"El Paraiso, Avenida Libertador...",error:!!a.houseAddress,helperText:((t=a.houseAddress)==null?void 0:t.type)=="maxLength"?"La direcci\xF3n no puede tener mas de 255 caracteres":((u=a.houseAddress)==null?void 0:u.type)=="required"?"La direcci\xF3n no puede estar vac\xEDa":"",...r})}})}),e(i,{item:!0,xs:4,children:e(m,{control:d,name:"houseMaxShares",rules:{required:!0,min:c&&n&&n.currentShares>0?n.currentShares:1},defaultValue:1,render:({field:r})=>{var t,u;return e(h,{fullWidth:!0,variant:"outlined",type:"number",label:"Cupos M\xE1ximos",error:!!a.houseMaxShares,helperText:((t=a.houseMaxShares)==null?void 0:t.type)=="required"?"Los cupos m\xE1ximos no pueden estar vac\xEDos":((u=a.houseMaxShares)==null?void 0:u.type)=="min"?"Los cupos m\xE1ximos no pueden ser menores que 1":"",...r})}})}),e(i,{item:!0,xs:4,children:e(m,{control:d,name:"houseMinimumAge",rules:{required:!0,min:0},defaultValue:0,render:({field:r})=>{var t,u;return e(h,{fullWidth:!0,variant:"outlined",type:"number",label:"Edad m\xEDnima para la entrada en la Casa",error:!!a.houseMinimumAge,helperText:((t=a.houseMinimumAge)==null?void 0:t.type)=="required"?"La edad minima no puede estar vac\xEDa":((u=a.houseMinimumAge)==null?void 0:u.type)=="min"?"La edad minima no puede ser menor que 0":"",...r})}})}),e(i,{item:!0,xs:4,children:e(m,{control:d,name:"houseMaximumAge",rules:{required:!0,min:1},defaultValue:1,render:({field:r})=>{var t,u,o;return e(h,{fullWidth:!0,variant:"outlined",type:"number",label:"Edad m\xE1xima para la estad\xEDa en la Casa",error:!!a.houseMaximumAge,helperText:((t=a.houseMaximumAge)==null?void 0:t.type)=="required"?"La edad maxima no puede estar vac\xEDa":((u=a.houseMaximumAge)==null?void 0:u.type)=="min"?"La edad maxima no puede ser menor que 1":((o=a.houseMaximumAge)==null?void 0:o.type)=="coherent"?"La edad maxima no puede ser menor que la edad m\xEDnima":"",...r})}})}),e(i,{item:!0,xs:6,children:e(m,{control:d,name:"houseScheduleStartTime",defaultValue:"00:00",render:({field:r})=>{var t;return e(h,{fullWidth:!0,variant:"outlined",type:"time",label:"Tiempo de inicio del horario de atenci\xF3n",error:!!a.houseScheduleStartTime,helperText:((t=a.houseScheduleStartTime)==null?void 0:t.type)=="coherent"?"El tiempo de inicio no puede ser posterior o igual al tiempo de fin":"",...r})}})}),e(i,{item:!0,xs:6,children:e(m,{control:d,name:"houseScheduleEndTime",defaultValue:"23:59",render:({field:r})=>{var t;return e(h,{fullWidth:!0,variant:"outlined",type:"time",label:"Tiempo de finalizaci\xF3n del horario de atenci\xF3n",error:!!a.houseScheduleEndTime,helperText:((t=a.houseScheduleEndTime)==null?void 0:t.type)=="coherent"?"El tiempo de finalizaci\xF3n no puede ser anterior o igual al de inicio":"",...r})}})}),e(i,{item:!0,xs:12,children:e(D,{sx:{color:"rgba(0,0,0,0.4)"},children:"CONTACTO"})}),e(i,{item:!0,xs:12,children:e(m,{control:d,name:"houseContactCI",rules:{required:!0,maxLength:9},defaultValue:"",render:({field:{onChange:r,...t}})=>e(ye,{freeSolo:!c,disableClearable:!0,options:p?Object.keys(p).map(u=>u.toString()):[],renderOption:(u,o)=>{const s=Number(o),l=p==null?void 0:p[s];return e("span",{...u,children:`${l==null?void 0:l.name} ${l==null?void 0:l.lastname} (${o})`})},defaultValue:t.value,loading:!p,renderInput:u=>{var o,s;return e(h,{...u,fullWidth:!0,variant:"outlined",type:"number",label:"C\xE9dula de Identidad",error:!!a.houseContactCI,helperText:((o=a.houseContactCI)==null?void 0:o.type)=="required"?"La c\xE9dula no puede estar vac\xEDa":((s=a.houseContactCI)==null?void 0:s.type)=="maxLength"?"La c\xE9dula no puede tener m\xE1s de 9 d\xEDgitos":"",InputProps:{...u.InputProps,type:"number",endAdornment:e(P,{position:"end",children:!p&&e(G,{size:"1.5em"})})}})},onChange:c?(u,o)=>r(o):void 0,onInputChange:c?void 0:(u,o)=>r(o),...t})})}),e(i,{item:!0,xs:6,children:e(m,{control:d,name:"houseContactName",defaultValue:"",rules:{required:!0,maxLength:50},render:({field:r})=>{var t,u;return e(h,{fullWidth:!0,variant:"outlined",label:"Nombre",InputProps:{readOnly:!!H},error:!!a.houseContactName,helperText:((t=a.houseContactName)==null?void 0:t.type)=="required"?"El nombre no puede estar vac\xEDo":((u=a.houseContactName)==null?void 0:u.type)=="maxLength"?"El nombre no puede tener m\xE1s de 50 d\xEDgitos":"",...r})}})}),e(i,{item:!0,xs:6,children:e(m,{control:d,name:"houseContactLastname",defaultValue:"",rules:{required:!0,maxLength:50},render:({field:r})=>{var t,u;return e(h,{fullWidth:!0,variant:"outlined",label:"Apellido",InputProps:{readOnly:!!H},error:!!a.houseContactLastname,helperText:((t=a.houseContactLastname)==null?void 0:t.type)=="required"?"El apellido no puede estar vac\xEDo":((u=a.houseContactLastname)==null?void 0:u.type)=="maxLength"?"El apellido no puede tener m\xE1s de 50 d\xEDgitos":"",...r})}})}),e(i,{item:!0,xs:12,children:e(D,{sx:{color:"rgba(0,0,0,0.4)"},children:"TEL\xC9FONOS"})}),Y.map((r,t)=>v(g.Fragment,{children:[e(i,{item:!0,xs:t==0?12:11,children:e(m,{control:d,defaultValue:"",name:`housePhones.${t}.value`,rules:{required:!0,pattern:/^[0-9]{3}-[0-9]{3}-[0-9]{4}$/},render:({field:u})=>{var o,s,l,x,A;return e(h,{fullWidth:!0,variant:"outlined",label:"Tel\xE9fono",error:!!((s=(o=a.housePhones)==null?void 0:o[t])!=null&&s.value),helperText:((A=(x=(l=a.housePhones)==null?void 0:l[t])==null?void 0:x.value)==null?void 0:A.type)=="pattern"?"El tel\xE9fono debe tener el formato 000-000-0000":"",...u})}})}),t!=0&&e(i,{item:!0,xs:1,children:e(B,{variant:"contained",color:"error",sx:{py:1.4,mr:"auto"},onClick:()=>ee(t),children:e(Se,{fontSize:"large"})})})]},r.id)),e(i,{item:!0,xs:12,children:e(B,{fullWidth:!0,color:"secondary",onClick:()=>Z({value:""}),children:e(fe,{fontSize:"large"})})})]}),e(be,{disabled:!K||Object.keys(a).length>0||R,loading:re,type:"submit",fullWidth:!0,variant:"contained",size:"large",sx:{mt:4},children:"Guardar Casa"})]})}export{Le as default};
